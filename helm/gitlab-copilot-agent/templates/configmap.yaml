apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "app.fullname" . }}
  labels: {{- include "app.labels" . | nindent 4 }}
data:
  GITLAB_URL: {{ required "gitlab.url is required" .Values.gitlab.url | quote }}
  HOST: "0.0.0.0"
  PORT: {{ .Values.controller.port | quote }}
  LOG_LEVEL: {{ .Values.controller.logLevel | quote }}
  TASK_EXECUTOR: {{ .Values.controller.taskExecutor | quote }}
  STATE_BACKEND: {{ .Values.controller.stateBackend | quote }}
  COPILOT_MODEL: {{ .Values.controller.copilotModel | quote }}
  K8S_NAMESPACE: {{ .Release.Namespace | quote }}
  K8S_JOB_IMAGE: {{ include "app.jobImage" . | quote }}
  K8S_JOB_CPU_LIMIT: {{ .Values.jobRunner.cpuLimit | quote }}
  K8S_JOB_MEMORY_LIMIT: {{ .Values.jobRunner.memoryLimit | quote }}
  K8S_JOB_TIMEOUT: {{ .Values.jobRunner.timeout | quote }}
  K8S_SECRET_NAME: {{ include "app.fullname" . | quote }}
  K8S_CONFIGMAP_NAME: {{ include "app.fullname" . | quote }}
  K8S_JOB_INSTANCE_LABEL: {{ include "app.fullname" . | quote }}
  {{- with .Values.hostAliases }}
  K8S_JOB_HOST_ALIASES: {{ . | toJson | quote }}
  {{- end }}
  {{- with .Values.controller.copilotProviderType }}
  COPILOT_PROVIDER_TYPE: {{ . | quote }}
  {{- end }}
  {{- with .Values.controller.copilotProviderBaseUrl }}
  COPILOT_PROVIDER_BASE_URL: {{ . | quote }}
  {{- end }}
  {{- with .Values.telemetry.otlpEndpoint }}
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ . | quote }}
  {{- end }}
  {{- with .Values.telemetry.environment }}
  DEPLOYMENT_ENV: {{ . | quote }}
  {{- end }}
  {{- with .Values.jira.url }}
  JIRA_URL: {{ . | quote }}
  {{- end }}
  {{- with .Values.jira.projectMap }}
  JIRA_PROJECT_MAP: {{ . | quote }}
  {{- end }}
  {{- if .Values.jira.url }}
  {{- with .Values.jira.triggerStatus }}
  JIRA_TRIGGER_STATUS: {{ . | quote }}
  {{- end }}
  {{- with .Values.jira.inProgressStatus }}
  JIRA_IN_PROGRESS_STATUS: {{ . | quote }}
  {{- end }}
  {{- with .Values.jira.inReviewStatus }}
  JIRA_IN_REVIEW_STATUS: {{ . | quote }}
  {{- end }}
  {{- if .Values.jira.pollInterval }}
  JIRA_POLL_INTERVAL: {{ .Values.jira.pollInterval | quote }}
  {{- end }}
  {{- end }}
  {{- range $key, $value := .Values.extraEnv }}
  {{- if $value }}
  {{ $key }}: {{ $value | quote }}
  {{- end }}
  {{- end }}
