apiVersion: v1
kind: Secret
metadata:
  name: {{ include "app.fullname" . }}
  labels: {{- include "app.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- $redisPassword := include "app.redisPassword" . }}
  GITLAB_TOKEN: {{ required "gitlab.token is required" .Values.gitlab.token | quote }}
  {{- with .Values.gitlab.webhookSecret }}
  GITLAB_WEBHOOK_SECRET: {{ . | quote }}
  {{- end }}
  REDIS_PASSWORD: {{ $redisPassword | quote }}
  REDIS_URL: "redis://:{{ $redisPassword | urlquery }}@{{ include "app.fullname" . }}-redis:{{ .Values.redis.port }}"
  {{- with .Values.github.token }}
  GITHUB_TOKEN: {{ . | quote }}
  {{- end }}
  {{- with .Values.controller.copilotProviderApiKey }}
  COPILOT_PROVIDER_API_KEY: {{ . | quote }}
  {{- end }}
  {{- with .Values.jira.email }}
  JIRA_EMAIL: {{ . | quote }}
  {{- end }}
  {{- with .Values.jira.apiToken }}
  JIRA_API_TOKEN: {{ . | quote }}
  {{- end }}
